<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Neuroblast Models — Interactive Grid</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f1115; --panel:#151925; --ink:#eef2ff; --muted:#9aa4b2;
      --nb:#1b9e77; --gmc:#d95f02; --im:#7570b3; --mat:#e7298a;
      --accent:#3b82f6; --border:#253049;
    }
    *{box-sizing:border-box}
    body{margin:0; font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
      color:var(--ink); background:linear-gradient(180deg,#0e1116,#0b0e14);}
    header{padding:18px 22px; border-bottom:1px solid var(--border);
      display:flex; gap:16px; align-items:center; justify-content:space-between;}
    header h1{margin:0; font-size:18px; font-weight:600}
    header .actions{display:flex; gap:8px; align-items:center}
    button{background:var(--accent); color:white; border:none; padding:8px 12px;
      border-radius:10px; cursor:pointer; font-weight:600;
      box-shadow:0 5px 20px rgba(59,130,246,.25);}
    button.secondary{background:#1f2937; color:#e5e7eb; box-shadow:none; border:1px solid var(--border);}
    button:disabled{opacity:.6; cursor:not-allowed}
    main{padding:18px; display:grid; grid-template-columns: 1fr 340px; gap:18px;}
    .grid{display:grid; grid-template-columns: repeat(3, 1fr); grid-auto-rows: 230px; gap:12px;}
    .cell{background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:10px; position:relative; overflow:hidden;}
    .cell h3{position:absolute; top:6px; left:10px; margin:0; font-size:12px; color:var(--muted); font-weight:600;}
    .row-title{grid-column: 1 / -1; margin:2px 0 6px; color:var(--muted); font-weight:700; letter-spacing:.02em;}
    svg{width:100%; height:100%;}
    .legend{display:flex; gap:14px; align-items:center; color:var(--muted); font-size:12px; padding:6px 0 10px;}
    .chip{display:inline-flex; gap:6px; align-items:center}
    .dot{width:12px; height:4px; border-radius:2px; background:currentColor}
    .controls{display:flex; flex-direction:column; gap:12px; position:sticky; top:12px; height:fit-content;
      background:var(--panel); border:1px solid var(--border); border-radius:14px; padding:12px;}
    .controls h2{margin:0 0 6px; font-size:14px}
    .card{border:1px solid var(--border); border-radius:12px; padding:10px; background:#111726; display:flex; flex-direction:column; gap:10px;}
    .card h3{margin:0; font-size:13px}
    .fields{display:grid; grid-template-columns: 1fr 1fr; gap:8px}
    .field{display:flex; flex-direction:column; gap:4px}
    .field label{font-size:12px; color:var(--muted)}
    .field input{background:#0c1220; color:var(--ink); border:1px solid var(--border);
      border-radius:10px; padding:8px 10px; font-weight:600;}
    .inline{display:flex; gap:8px; align-items:center; justify-content:space-between;}
    .tiny{font-size:12px; color:var(--muted)}
    .badge{display:inline-block; padding:2px 6px; border-radius:8px; background:#0b1222; border:1px solid var(--border);
      font-size:11px; color:#cbd5e1; font-weight:600;}
    .titlebar{display:flex; align-items:center; justify-content:space-between; margin:2px 0 10px;}
    .help{font-size:12px; color:var(--muted)}
    @media (max-width: 1100px){ main{grid-template-columns: 1fr} .controls{position:static} }
  </style>
</head>
<body>
  <header>
    <h1>Neuroblast models — interactive grid</h1>
    <div class="actions">
      <button class="secondary" id="reset">Reset to paper defaults</button>
      <button id="shareAll">Share current setup</button>
    </div>
  </header>

  <main>
    <!-- LEFT: PLOTS -->
    <section>
      <div class="titlebar">
        <div class="legend">
          <span class="chip" style="color:var(--nb)"><span class="dot"></span> NB</span>
          <span class="chip" style="color:var(--gmc)"><span class="dot"></span> GMC</span>
          <span class="chip" style="color:var(--im)"><span class="dot"></span> Im</span>
          <span class="chip" style="color:var(--mat)"><span class="dot"></span> Mat</span>
          <span class="badge">Time: 0–48 h</span>
        </div>
        <div class="help">Edit parameters on the right, then click “Run row”.</div>
      </div>

      <div class="row-title">WT • mud mutant • nanobody</div>
      <div id="grid" class="grid" aria-label="plots grid"></div>
    </section>

    <!-- RIGHT: CONTROLS -->
    <aside class="controls">
      <h2>Controls</h2>

      <!-- GLOBAL PARAMS (from your Python cell) -->
      <div class="card">
        <h3>Global parameters</h3>
        <div class="fields">
          <!-- time & numerics -->
          <div class="field"><label>tEnd (h)</label><input type="number" step="0.5" data-key="tEnd" value="48"></div>
          <div class="field"><label>dt (h)</label><input type="number" step="0.01" data-key="dt" value="0.1"></div>

          <!-- volume & exponents -->
          <div class="field"><label>nb_vol (V0)</label><input type="number" step="0.1" data-key="nb_vol" value="285"></div>
          <div class="field"><label>n (Hill)</label><input type="number" step="0.1" data-key="n" value="3"></div>

          <!-- GMC / thresholds / floors -->
          <div class="field"><label>k_max_GMC</label><input type="number" step="0.0001" data-key="k_max_GMC" value="0.125"></div>
          <div class="field"><label>V_thresh_NB</label><input type="number" step="0.1" data-key="V_thresh_NB" value="356.25"></div>
          <div class="field"><label>V_thresh_GMC</label><input type="number" step="0.1" data-key="V_thresh_GMC" value="142.5"></div>
          <div class="field"><label>V_floor_NB</label><input type="number" step="0.1" data-key="V_floor_NB" value="71.25"></div>
          <div class="field"><label>V_floor_GMC</label><input type="number" step="0.01" data-key="V_floor_GMC" value="17.8125"></div>

          <!-- rates -->
          <div class="field"><label>k_Neuron</label><input type="number" step="0.0001" data-key="k_Neuron" value="0.0208333333"></div>
          <div class="field"><label>g_GMC</label><input type="number" step="0.0001" data-key="g_GMC" value="7.9166666667"></div>

          <!-- WT calibration -->
          <div class="field"><label>k_star</label><input type="number" step="0.0001" data-key="k_star" value="0.6666666667"></div>

          <!-- Model 2/4 extras -->
          <div class="field"><label>V_thresh_base</label><input type="number" step="0.1" data-key="V_thresh_base" value="356.25"></div>
          <div class="field"><label>delta_thresh</label><input type="number" step="0.01" data-key="delta_thresh" value="10.6875"></div>
          <div class="field"><label>V_thresh_min</label><input type="number" step="0.1" data-key="V_thresh_min" value="71.25"></div>

          <!-- Model 5 -->
          <div class="field"><label>K_self</label><input type="number" step="0.01" data-key="K_self" value="2.0"></div>
          <div class="field"><label>β default</label><input type="number" step="0.1" data-key="beta_default" value="4"></div>
        </div>
        <div class="tiny">Derived values (k_max_NB, g_NB_WT) are recomputed automatically from <em>k_star, nb_vol, V_thresh_NB, n</em>.</div>
      </div>

      <!-- MODEL CARDS (only model-specific params) -->
      <div class="card">
        <h3>Model 1 — static thresholds</h3>
        <div class="inline">
          <button data-run="1">Run row</button>
          <button class="secondary tiny" data-share="1">Share row</button>
        </div>
      </div>

      <div class="card">
        <h3>Model 2 — sym pulls threshold</h3>
        <div class="inline">
          <button data-run="2">Run row</button>
          <button class="secondary tiny" data-share="2">Share row</button>
        </div>
      </div>

      <div class="card">
        <h3>Model 3 — vol-scaled growth</h3>
        <div class="fields">
          <div class="field"><label>α (growth exponent)</label><input type="number" step="0.1" data-key="m3_alpha" value="3"></div>
        </div>
        <div class="inline">
          <button data-run="3">Run row</button>
          <button class="secondary tiny" data-share="3">Share row</button>
        </div>
      </div>

      <div class="card">
        <h3>Model 4 — vol-scaled + sym-thresh</h3>
        <div class="fields">
          <div class="field"><label>α (growth exponent)</label><input type="number" step="0.1" data-key="m4_alpha" value="3"></div>
        </div>
        <div class="inline">
          <button data-run="4">Run row</button>
          <button class="secondary tiny" data-share="4">Share row</button>
        </div>
      </div>

      <div class="card">
        <h3>Model 5 — NB self-repression</h3>
        <div class="fields">
          <div class="field"><label>β (div exponent)</label><input type="number" step="0.1" data-key="m5_beta" value="4"></div>
        </div>
        <div class="inline">
          <button data-run="5">Run row</button>
          <button class="secondary tiny" data-share="5">Share row</button>
        </div>
      </div>

      <div class="inline"><div class="tiny">Tip: Shareable links encode all current inputs.</div></div>
      <div class="inline"><button id="shareAll">Share current setup</button></div>
    </aside>
  </main>

  <script src="app.js"></script>
</body>
</html>